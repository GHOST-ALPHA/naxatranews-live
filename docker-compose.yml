services:
  # Next.js Application
  app:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - NEXT_PUBLIC_LIVE_TV_URL=${NEXT_PUBLIC_LIVE_TV_URL}
        - NEXT_PUBLIC_LIVE_TV_ENABLED=${NEXT_PUBLIC_LIVE_TV_ENABLED}
        - NEXT_PUBLIC_BASE_URL=${NEXT_PUBLIC_BASE_URL}
        - NEXT_PUBLIC_GA_MEASUREMENT_ID=${NEXT_PUBLIC_GA_MEASUREMENT_ID}
        - NEXT_PUBLIC_GA4_ID=${NEXT_PUBLIC_GA4_ID}
        - NEXT_PUBLIC_GTM_ID=${NEXT_PUBLIC_GTM_ID}
        - NEXT_PUBLIC_ADSENSE_CLIENT=${NEXT_PUBLIC_ADSENSE_CLIENT}
    container_name: naxatra_app
    restart: unless-stopped
    ports:
      - "4141:4141"
    env_file:
      - .env
    environment:
      # Connecting to existing container 'nbharat24_postgres' on the same network
      - DATABASE_URL=postgresql://postgres:TaklaMakan171055@nbharat24_postgres:5432/naxatra_db_prod?schema=public
      - NODE_ENV=production
    volumes:
      # Persistent media storage
      - media_storage:/app/public/storage/media
      - thumbnails_storage:/app/public/storage/thumbnails
    networks:
      - default
    # Start the Next.js server
    command: ["node", "server.js"]

volumes:
  # Media storage persistence
  media_storage:
    driver: local
  thumbnails_storage:
    driver: local

networks:
  default:
    external: true
    name: nbharat24_nbharat24_network
